name: ðŸ”” AROG - Monitoring & Error Tracking Setup

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  setup-monitoring:
    name: Configure Monitoring
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout Code
        uses: actions/checkout@v4
        
      - name: ðŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      - name: ðŸ”” Validate Monitoring Configuration
        run: |
          node -e "
          const fs = require('fs');
          
          console.log('\\nðŸ”” Checking monitoring configuration...\\n');
          
          // Check for Sentry configuration
          const hasSentry = process.env.SENTRY_DSN || fs.existsSync('.sentryclirc');
          console.log(hasSentry ? 'âœ… Sentry configured' : 'âš ï¸  Sentry not configured');
          
          // Check for error tracking
          const hasErrorTracking = fs.existsSync('src/monitoring') || 
                                    fs.existsSync('src/utils/error-tracking.js');
          console.log(hasErrorTracking ? 'âœ… Error tracking setup found' : 'âš ï¸  No error tracking detected');
          
          // Check for logging
          const hasLogging = fs.existsSync('src/utils/logger.js') || 
                             fs.existsSync('src/logging');
          console.log(hasLogging ? 'âœ… Logging setup found' : 'âš ï¸  No logging setup detected');
          
          console.log('\\nðŸ“Š Monitoring Health Check Complete\\n');
          "
          
      - name: ðŸ“Š Create Monitoring Guide
        run: |
          cat > MONITORING.md << 'EOF'
          # ðŸ”” AROG Monitoring & Error Tracking
          
          ## Error Tracking with Sentry
          
          ### Setup
          \`\`\`bash
          npm install @sentry/node @sentry/tracing
          \`\`\`
          
          ### Configuration
          \`\`\`javascript
          // src/monitoring/sentry.js
          const Sentry = require('@sentry/node');
          const Tracing = require('@sentry/tracing');
          
          Sentry.init({
            dsn: process.env.SENTRY_DSN,
            environment: process.env.NODE_ENV || 'development',
            tracesSampleRate: 1.0,
            integrations: [
              new Sentry.Integrations.Http({ tracing: true }),
            ],
          });
          
          module.exports = Sentry;
          \`\`\`
          
          ### Usage
          \`\`\`javascript
          const Sentry = require('./monitoring/sentry');
          
          try {
            // Your code
          } catch (error) {
            Sentry.captureException(error);
            throw error;
          }
          \`\`\`
          
          ## Logging with Winston
          
          ### Setup
          \`\`\`bash
          npm install winston
          \`\`\`
          
          ### Configuration
          \`\`\`javascript
          // src/utils/logger.js
          const winston = require('winston');
          
          const logger = winston.createLogger({
            level: process.env.LOG_LEVEL || 'info',
            format: winston.format.json(),
            transports: [
              new winston.transports.File({ filename: 'error.log', level: 'error' }),
              new winston.transports.File({ filename: 'combined.log' }),
            ],
          });
          
          if (process.env.NODE_ENV !== 'production') {
            logger.add(new winston.transports.Console({
              format: winston.format.simple(),
            }));
          }
          
          module.exports = logger;
          \`\`\`
          
          ## Health Checks
          
          ### Endpoint
          \`\`\`javascript
          app.get('/health', (req, res) => {
            res.json({
              status: 'healthy',
              timestamp: new Date().toISOString(),
              uptime: process.uptime(),
              memory: process.memoryUsage(),
            });
          });
          \`\`\`
          
          ## Environment Variables
          
          Add to your \`.env\`:
          \`\`\`
          SENTRY_DSN=your_sentry_dsn_here
          LOG_LEVEL=info
          NODE_ENV=production
          \`\`\`
          
          ## GitHub Actions Integration
          
          Add Sentry release tracking to your deploy workflow:
          \`\`\`yaml
          - name: Create Sentry Release
            uses: getsentry/action-release@v1
            env:
              SENTRY_AUTH_TOKEN: \${{ secrets.SENTRY_AUTH_TOKEN }}
              SENTRY_ORG: your-org
              SENTRY_PROJECT: your-project
            with:
              environment: production
          \`\`\`
          EOF
          
          echo "âœ… Monitoring guide created: MONITORING.md"
          
      - name: ðŸ“¤ Upload Monitoring Guide
        uses: actions/upload-artifact@v3
        with:
          name: monitoring-guide
          path: MONITORING.md
          retention-days: 90
